<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8" />
    <title>URL 编解码（支持全字节编码 & 自动识别解码）</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <style>
        :root {
            --bg: #f6fbff;
            --card: #ffffff;
            --accent: #0f62fe;
            --accent-2: #ff7a00;
            --muted: #98a6b3;
            --success: #15b37a;
            --danger: #ff4567;
            --radius: 18px;
            --shadow: 0 12px 40px rgba(12, 40, 80, 0.06);
            --glass: rgba(255, 255, 255, 0.85);
            --transition: 320ms cubic-bezier(.2, .9, .28, 1);
        }

        * {
            box-sizing: border-box
        }

        html,
        body {
            height: 100%
        }

        body {
            margin: 0;
            font-family: "Segoe UI", Roboto, "Helvetica Neue", Arial, "PingFang SC", "Microsoft YaHei", sans-serif;
            background: linear-gradient(180deg, #eef8ff 0%, #fbfff7 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 28px;
            color: #213244;
        }

        .app {
            width: 920px;
            max-width: 98vw;
            border-radius: calc(var(--radius) + 6px);
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.98));
            box-shadow: var(--shadow);
            overflow: hidden;
            transition: box-shadow var(--transition);
            display: grid;
            grid-template-columns: 1fr 12px 1fr;
            align-items: stretch;
        }

        .header {
            grid-column: 1 / -1;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 18px 26px;
            border-bottom: 1px solid #f0f4f8;
            background: linear-gradient(90deg, rgba(15, 98, 254, 0.03), rgba(255, 122, 0, 0.02));
        }

        .title {
            display: flex;
            align-items: center;
            gap: 14px;
        }

        .logo {
            width: 44px;
            height: 44px;
            border-radius: 10px;
            background: linear-gradient(135deg, var(--accent), var(--accent-2));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 18px;
            box-shadow: 0 6px 22px rgba(15, 98, 254, 0.12);
        }

        .title h1 {
            margin: 0;
            font-size: 1.05rem;
            letter-spacing: 0.2px;
        }

        .title p {
            margin: 0;
            font-size: 0.86rem;
            color: var(--muted);
        }

        .toolbar {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .small {
            font-size: 0.9rem;
            color: var(--muted);
            background: rgba(10, 20, 40, 0.02);
            padding: 6px 10px;
            border-radius: 8px;
        }

        .col {
            padding: 22px 22px 26px;
            background: var(--glass);
            position: relative;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .divider {
            width: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .divider .bar {
            width: 3px;
            height: 72%;
            border-radius: 8px;
            background: linear-gradient(180deg, var(--accent), var(--accent-2));
            opacity: 0.08;
        }

        h2 {
            margin: 0;
            font-size: 1rem;
            color: var(--accent-2);
            font-weight: 600;
        }

        .muted {
            color: var(--muted);
            font-size: 0.92rem;
        }

        .controls {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
            margin-top: 6px;
        }

        textarea {
            width: 100%;
            min-height: 180px;
            resize: vertical;
            padding: 14px 14px;
            border-radius: 12px;
            border: 1px solid rgba(20, 30, 45, 0.03);
            background: linear-gradient(180deg, #ffffff, #fbfdff);
            font-size: 0.98rem;
            line-height: 1.5;
            color: #0f2130;
            box-shadow: inset 0 2px 10px rgba(12, 20, 40, 0.02);
            transition: box-shadow var(--transition), border-color var(--transition);
        }

        textarea:focus {
            outline: none;
            box-shadow: 0 8px 30px rgba(15, 98, 254, 0.06);
            border-color: rgba(15, 98, 254, 0.16)
        }

        .btn {
            padding: 9px 14px;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            background: linear-gradient(90deg, var(--accent), var(--accent-2));
            color: white;
            font-weight: 600;
            box-shadow: 0 6px 18px rgba(12, 40, 120, 0.08);
            transition: transform var(--transition), box-shadow var(--transition);
        }

        .btn.ghost {
            background: transparent;
            color: var(--muted);
            box-shadow: none;
            border: 1px solid rgba(10, 20, 40, 0.04)
        }

        .row {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .flex1 {
            flex: 1
        }

        .switch {
            display: flex;
            gap: 8px;
            align-items: center;
            padding: 6px 10px;
            border-radius: 10px;
            background: rgba(10, 20, 40, 0.02);
            color: var(--muted);
            font-size: 0.92rem;
        }

        .switch input {
            transform: scale(1.02);
            margin-right: 6px;
        }

        .hint {
            font-size: 0.9rem;
            color: var(--muted);
        }

        .copied {
            color: var(--success);
            font-weight: 700;
            opacity: 0;
            transition: opacity 220ms
        }

        .copied.show {
            opacity: 1
        }

        .error {
            border: 1px solid var(--danger);
            background: #fff6f8;
        }

        @media (max-width:880px) {
            .app {
                grid-template-columns: 1fr;
                gap: 0
            }

            .divider {
                display: none
            }

            .header {
                padding: 14px
            }

            .col {
                padding: 16px
            }

            textarea {
                min-height: 140px
            }
        }
    </style>
</head>

<body>
    <div class="app" role="application" aria-label="URL 编解码工具">
        <div class="header">
            <div class="title">
                <div class="logo">URL</div>
                <div>
                    <h1>URL 编解码（支持全字节 & 自动识别）</h1>
                    <p class="muted">自动检测 %XX 并解码；也可强制编码（包括英文字母）为 %HH</p>
                </div>
            </div>
            <div class="toolbar">
                <div class="small">实时双向</div>
                <button class="btn ghost" id="helpBtn" title="使用说明">说明</button>
            </div>
        </div>

        <div class="col col-left" id="leftCol">
            <h2 id="inputLabel">原始内容</h2>

            <div class="row controls">
                <label class="switch"><input type="checkbox" id="fullEncode" checked />全字节编码（A–Z 也编码）</label>
                <label class="switch" title="如果开启，遇到 %xx 会自动尝试解码"><input type="checkbox" id="autoDetect"
                        checked />自动识别并解码</label>
                <div class="hint">双击输入区或按 Ctrl/Cmd+K 可切换“编 ↔ 解”方向</div>
                <div style="flex:1"></div>
                <button class="btn ghost" id="clearInput" title="清空输入">清空</button>
            </div>

            <textarea id="inputArea" placeholder="输入任意内容（支持中文、英文、%xx 序列、URL 等）"></textarea>

            <div class="row">
                <button class="btn" id="runBtn">立即编/解码</button>
                <div class="hint">或直接在上方输入，结果将实时更新</div>
            </div>
        </div>

        <div class="divider">
            <div class="bar"></div>
        </div>

        <div class="col col-right" id="rightCol">
            <h2 id="outputLabel">编码 / 解码 结果</h2>

            <div class="row controls">
                <div class="muted" id="modeLabel">当前模式：编码 → 解码</div>
                <div style="flex:1"></div>
                <div class="copied" id="copyMark">已复制</div>
                <button class="btn ghost" id="clearOutput">清空</button>
                <button class="btn" id="copyBtn">复制</button>
            </div>

            <textarea id="outputArea" readonly placeholder="编码或解码结果会显示在此处"></textarea>

            <div class="row" style="margin-top:6px;">
                <div class="hint">若解码失败，请检查 %xx 是否完整且为合法十六进制（例如 %E5%BC%A0）</div>
            </div>
        </div>
    </div>

    <script>
        // DOM
        const inputArea = document.getElementById('inputArea');
        const outputArea = document.getElementById('outputArea');
        const fullEncodeEl = document.getElementById('fullEncode');
        const autoDetectEl = document.getElementById('autoDetect');
        const runBtn = document.getElementById('runBtn');
        const copyBtn = document.getElementById('copyBtn');
        const clearInput = document.getElementById('clearInput');
        const clearOutput = document.getElementById('clearOutput');
        const copyMark = document.getElementById('copyMark');
        const modeLabel = document.getElementById('modeLabel');

        // 状态
        let encodeDirect = true; // true: 输入 -> 编码输出 ; false: 输入视为 percent-encoded -> 解码输出
        let isSyncing = false;

        // 全字节编码：将字符串转为 UTF-8 字节后逐字节 %HH（大写）
        function percentEncodeAll(str) {
            const utf8 = unescape(encodeURIComponent(str || ''));
            let out = '';
            for (let i = 0; i < utf8.length; i++) {
                out += '%' + utf8.charCodeAt(i).toString(16).toUpperCase().padStart(2, '0');
            }
            return out;
        }
        // 标准 encodeURIComponent
        function standardEncode(str) {
            try { return encodeURIComponent(str || ''); } catch (e) { return ''; }
        }
        // 解码（智能）
        function smartDecode(str) {
            if (!str) return '';
            try {
                return decodeURIComponent(str.replace(/\+/g, ' '));
            } catch (e) {
                return null;
            }
        }

        // 判断文本是否包含可能的 percent-encoding 模式 (%HH)
        function looksLikePercentEncoding(s) {
            return /%[0-9A-Fa-f]{2}/.test(s);
        }

        // 主同步逻辑，包含自动识别解码
        function syncRealtime() {
            if (isSyncing) return;
            isSyncing = true;
            const txt = inputArea.value || '';
            const fullEncode = !!fullEncodeEl.checked;
            const autoDetect = !!autoDetectEl.checked;

            // 自动检测优先级：当 autoDetect 开启且文本看起来像 %xx，则尝试解码；解码成功则显示解码结果并进入解码提示（但不改变 encodeDirect）
            if (autoDetect && looksLikePercentEncoding(txt)) {
                const dec = smartDecode(txt);
                if (dec !== null) {
                    outputArea.value = dec;
                    outputArea.classList.remove('error');
                    modeLabel.textContent = '自动识别：检测到 %xx → 已解码';
                    isSyncing = false;
                    return;
                } else {
                    // 若自动解码失败，再继续按当前 encodeDirect 逻辑处理（并给出错误提示）
                }
            }

            // 按当前方向处理
            if (encodeDirect) {
                // 编码方向：原文 -> 输出编码
                if (!txt) {
                    outputArea.value = '';
                    modeLabel.textContent = '当前模式：编码 → 解码';
                } else {
                    outputArea.value = fullEncode ? percentEncodeAll(txt) : standardEncode(txt);
                    modeLabel.textContent = '当前模式：编码 → 解码';
                }
                outputArea.classList.remove('error');
            } else {
                // 解码方向：将输入作为 percent-encoded 文本去 decode
                if (!txt) {
                    outputArea.value = '';
                    inputArea.classList.remove('error');
                    outputArea.classList.remove('error');
                    modeLabel.textContent = '当前模式：解码 → 编码';
                } else {
                    const dec = smartDecode(txt);
                    if (dec === null) {
                        outputArea.value = '[解码失败] 输入不是合法的 percent-encoding';
                        outputArea.classList.add('error');
                        inputArea.classList.add('error');
                    } else {
                        outputArea.value = dec;
                        outputArea.classList.remove('error');
                        inputArea.classList.remove('error');
                    }
                    modeLabel.textContent = '当前模式：解码 → 编码';
                }
            }
            isSyncing = false;
        }

        // 事件绑定
        inputArea.addEventListener('input', syncRealtime);
        fullEncodeEl.addEventListener('change', syncRealtime);
        autoDetectEl.addEventListener('change', syncRealtime);

        runBtn.addEventListener('click', () => { syncRealtime(); outputArea.focus(); outputArea.select(); });

        copyBtn.addEventListener('click', () => {
            outputArea.select();
            try {
                document.execCommand('copy');
                copyMark.classList.add('show');
                setTimeout(() => copyMark.classList.remove('show'), 900);
            } catch (e) { /* ignore */ }
        });

        clearInput.addEventListener('click', () => { inputArea.value = ''; syncRealtime(); inputArea.focus(); });
        clearOutput.addEventListener('click', () => { outputArea.value = ''; syncRealtime(); });

        // 双击输出把内容回填到输入并自动切换处理方向（便捷）
        outputArea.addEventListener('dblclick', () => {
            if (outputArea.value) {
                inputArea.value = outputArea.value;
                encodeDirect = !encodeDirect;
                syncRealtime();
            }
        });

        // 双击输入区切换方向
        inputArea.addEventListener('dblclick', () => {
            encodeDirect = !encodeDirect;
            syncRealtime();
        });

        // 快捷键 Ctrl/Cmd+K 切换方向
        window.addEventListener('keydown', (e) => {
            if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'k') {
                e.preventDefault();
                encodeDirect = !encodeDirect;
                syncRealtime();
            }
        });

        // 支持粘贴文件
        inputArea.addEventListener('paste', function (e) {
            const items = (e.clipboardData || window.clipboardData).items;
            for (let i = 0; i < items.length; i++) {
                if (items[i].kind === 'file') {
                    e.preventDefault();
                    const file = items[i].getAsFile();
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function (evt) {
                            inputArea.value = evt.target.result;
                            syncRealtime();
                        };
                        reader.readAsText(file, 'utf-8');
                    }
                }
            }
        });

        // 初始
        window.addEventListener('load', () => {
            inputArea.value = '';
            outputArea.value = '';
            fullEncodeEl.checked = true;
            autoDetectEl.checked = true;
            encodeDirect = true;
            syncRealtime();
        });

        // 帮助
        document.getElementById('helpBtn').addEventListener('click', () => {
            alert(
                '说明：\\n' +
                '- 默认启用「全字节编码」，会对每个字符（包括英文字母）按 UTF-8 字节逐字节编码为 %HH。\\n' +
                '- 若取消勾选则使用标准 encodeURIComponent（保留字母和数字不编码）。\\n' +
                '- 开启「自动识别并解码」时，输入含 %XX 且为合法 percent-encoding 将自动解码并显示原文。\\n' +
                '- 双击输入区或按 Ctrl/Cmd+K 可切换「编 ↔ 解」方向；双击输出可回填并自动切换方向。'
            );
        });
    </script>
</body>

</html>